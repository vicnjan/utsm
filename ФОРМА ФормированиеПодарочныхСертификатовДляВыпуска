//Вспомогательные процедуры и функции
Процедура КнопкаВыполнитьНажатие(Кнопка)
  ПечатьСписка();	
КонецПроцедуры

Процедура КоманднаяПанель1ЗаполнитьПоПараметрам(Кнопка)
	Ошибка=ложь;
	Если не  ЗначениеЗаполнено(ПодарочныйСертификат) тогда
		Сообщить ("Не выбран подарочный сертификат!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли;	
	Если не  ЗначениеЗаполнено(НачальныйНомер) тогда
		Сообщить ("Не задано значение начального номера сертификата!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли;	
	Если не  ЗначениеЗаполнено(Количество) тогда
		Сообщить ("Не задано количество сертификатов!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли; 
	Если не  ЗначениеЗаполнено(Номинал) тогда
		Сообщить ("Не задан номинал сертификатов!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли; 
	Срочный = (ПодарочныйСертификат = Справочники.Номенклатура.РазовыйСрочный) или (ПодарочныйСертификат = Справочники.Номенклатура.МногоРазовыйСрочный);
	Если Срочный и не  ЗначениеЗаполнено(ДатаОкончания) тогда
		Сообщить ("Не задана Дата окончания для срочных сертификатов!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли;
	
	Если Ошибка тогда
		Предупреждение ("Проверьте заполнение параметров!");
		возврат;
	КонецЕсли;	
	
	Если  ПодарочныеСертификаты.Количество()>0 тогда
		Если Вопрос("При заполнении по параметрам табличная часть будет очищена. Продолжить?", РежимДиалогаВопрос.ДаНет)=КодВозвратаДиалога.Да  тогда
			ПодарочныеСертификаты.Очистить();
		Иначе
			Возврат;
		КонецЕсли;
	КонецЕсли;		
	Для Ном = НачальныйНомер по НачальныйНомер +Количество-1  цикл
		СтрПС =  ПодарочныеСертификаты.Добавить();
		стрПс.ПодарочныйСертификат = ПодарочныйСертификат;
		СтрПС.Номинал = Номинал;
		Стрпс.НомерШК = Формат(Ном,"ЧЦ=20; ЧДЦ=0; ЧГ=0");
		Если ТипШтрихКода = ПланыВидовХарактеристик.ТипыШтрихкодов.Code39 тогда
			стрПС.ШтрихКод =стрПС.НомерШК;
		Иначе
			стрПС.ШтрихКод =СформироватьШтрихКод(стрПС.НомерШК);
    	КонецЕсли;

		если Срочный  тогда
			стрпс.ДатаОкончания = ДатаОкончания;
		КонецЕсли;	
	КонецЦикла;	
	
	
КонецПроцедуры

Процедура ПодарочныйСертификаНачалоВыбора(Элемент, СтандартнаяОбработка)
	ПодарочныйСертификатВыбор(Элемент, СтандартнаяОбработка);

КонецПроцедуры

Процедура ПодарочныйСертификаПриИзменении(Элемент)
	Срочный = (ПодарочныйСертификат = Справочники.Номенклатура.РазовыйСрочный) или (ПодарочныйСертификат = Справочники.Номенклатура.МногоРазовыйСрочный);
	ЭлементыФормы.ДатаОкончания.Видимость = Срочный;
	ЭлементыФормы.НадписьДатаОкончания.Видимость = Срочный;
	//ЭлементыФормы.ПодарочныеСертификаты.Колонки.ДатаОкончания.Видимость = Срочный;

КонецПроцедуры

Процедура КоманднаяПанель1ДобавитьПоПараметрам(Кнопка)
	Ошибка=ложь;
	Если не  ЗначениеЗаполнено(ПодарочныйСертификат) тогда
		Сообщить ("Не выбран подарочный сертификат!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли;	
	Если не  ЗначениеЗаполнено(НачальныйНомер) тогда
		Сообщить ("Не задано значение начального номера сертификата!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли;	
	Если не  ЗначениеЗаполнено(Количество) тогда
		Сообщить ("Не задано количество сертификатов!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли; 
	Если не  ЗначениеЗаполнено(Номинал) тогда
		Сообщить ("Не задан номинал сертификатов!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли; 
	Срочный = (ПодарочныйСертификат = Справочники.Номенклатура.РазовыйСрочный) или (ПодарочныйСертификат = Справочники.Номенклатура.МногоРазовыйСрочный);
	Если Срочный и не  ЗначениеЗаполнено(ДатаОкончания) тогда
		Сообщить ("Не задана Дата окончания для срочных сертификатов!",СтатусСообщения.Внимание);
		Ошибка=Истина;
	КонецЕсли;
	
	Если Ошибка тогда
		Предупреждение ("Проверьте заполнение параметров!");
		возврат;
	КонецЕсли;	
	
	
	Для Ном = НачальныйНомер по НачальныйНомер +Количество-1  цикл
		Если ПодарочныеСертификаты.Найти(Формат(Ном,"ЧЦ=20; ЧДЦ=0; ЧГ=0"),"НомерШК")=Неопределено тогда
			СтрПС =  ПодарочныеСертификаты.Добавить();
			стрПс.ПодарочныйСертификат = ПодарочныйСертификат;
			СтрПС.Номинал = Номинал;
			Стрпс.НомерШК =Формат(Ном,"ЧЦ=20; ЧДЦ=0; ЧГ=0");
			Если ТипШтрихКода = ПланыВидовХарактеристик.ТипыШтрихкодов.Code39 тогда
				стрПС.ШтрихКод =стрПС.НомерШК;
			Иначе
				стрПС.ШтрихКод =СформироватьШтрихКод(стрПС.НомерШК);
			КонецЕсли;
			если Срочный  тогда
				стрпс.ДатаОкончания = ДатаОкончания;
			КонецЕсли;	
		Иначе
			Предупреждение("Подарочный сертификат с номером: "+ Формат(Ном,"ЧЦ=20; ЧДЦ=0; ЧГ=0")+" уже присутсвует в таблице."+символы.ПС+
			"Формирование списка подарочных сертификатов остановлено!");
			Сообщить("Подарочный сертификат с номером: "+ Формат(Ном,"ЧЦ=20; ЧДЦ=0; ЧГ=0")+" уже присутсвует в таблице. Формирование списка подарочных сертификатов остановлено!",СтатусСообщения.Внимание);
			Возврат;
		КонецЕсли;	
	КонецЦикла;	
	
	
КонецПроцедуры

Процедура ОсновныеДействияФормыЗаписать(Кнопка)
записатьХарактеристики(УстанавливатьЦену,РозничнаяЦена);
КонецПроцедуры

Процедура КоманднаяПанель1Проверить(Кнопка)
	Для каждого стрПС из ПодарочныеСертификаты цикл
		ПроверитьХарактеристикуПоПараметрам(стрПС);
	КонецЦикла;	
	Сообщить("Проверка закончена",СтатусСообщения.Информация);
КонецПроцедуры

Процедура ПриОткрытии()
	ЭлементыФормы.РозничнаяЦена.Доступность = УстанавливатьЦену;
	ТипШтрихКода = ПланыВидовХарактеристик.ТипыШтрихкодов.EAN13;
КонецПроцедуры

Процедура Флажок1ПриИзменении(Элемент)
	ЭлементыФормы.РозничнаяЦена.Доступность = УстанавливатьЦену;
КонецПроцедуры

Процедура ТипШтрихКодаПриИзменении(Элемент)
	Если не( ТипШтрихКода = ПланыВидовХарактеристик.ТипыШтрихкодов.EAN13 или  ТипШтрихКода = ПланыВидовХарактеристик.ТипыШтрихкодов.Code39) тогда
		Предупреждение ("Предусмотрена работа только с EAN13 или Code39!");
	КонецЕсли;	
КонецПроцедуры

Процедура ТипШтрихКодаНачалоВыбора(Элемент, СтандартнаяОбработка)
	СтандартнаяОбработка = Ложь;
	ФормаВыбора=ПланыВидовХарактеристик.ТипыШтрихкодов.ПолучитьФормуВыбора();
	СписокНазначений = Новый СписокЗначений;
	СписокНазначений.Добавить(ПланыВидовХарактеристик.ТипыШтрихкодов.Code39);
	СписокНазначений.Добавить(ПланыВидовХарактеристик.ТипыШтрихкодов.EAN13);
	ФормаВыбора.Отбор.Ссылка.ВидСравнения = ВидСравнения.ВСписке;
	ФормаВыбора.Отбор.Ссылка.Значение = СписокНазначений;
	ФормаВыбора.Отбор.Ссылка.Использование = Истина;

	Элемент.Значение = ФормаВыбора.ОткрытьМодально();

КонецПроцедуры
